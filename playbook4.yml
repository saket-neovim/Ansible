- name: Ensure Apache is installed and running on all nodes
  hosts: all
  become: true
  tasks:
    - name: Install Apache on Debian/Ubuntu
      ansible.builtin.apt:
        name: apache2
        state: present
        update_cache: true
      when: ansible_facts['os_family'] == 'Debian'
    - name: Gather service facts
      ansible.builtin.service_facts:
    - name: Start Apache service if not running (Debian/Ubuntu)
      ansible.builtin.service:
        name: apache2
        state: started
        enabled: true
      when:
        - "'apache2.service' in ansible_facts.services"
        - ansible_facts.services['apache2.service'].state != 'running'
